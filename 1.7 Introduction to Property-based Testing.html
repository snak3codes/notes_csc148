
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- common.css -->
      <style>* {-webkit-tap-highlight-color: rgba(0,0,0,0);}html {-webkit-text-size-adjust: none;}body {font-family: -apple-system, Helvetica, Arial, sans-serif;margin: 0;padding: 20px;color: #333;word-wrap: break-word;}h1, h2, h3, h4, h5, h6 {line-height: 1.1;}img {max-width: 100% !important;height: auto;}blockquote {margin: 0;padding: 0 15px;color: #777;border-left: 4px solid #ddd;}hr {background-color: #ddd;border: 0;height: 1px;margin: 15px 0;}code {font-family: Menlo, Consolas, 'Ubuntu Mono', Monaco, 'source-code-pro', monospace;line-height: 1.4;margin: 0;padding: 0.2em 0;font-size: 90%;background-color: rgba(0,0,0,0.04);border-radius: 3px;}pre > code {margin: 0;padding: 0;font-size: 100%;word-break: normal;background: transparent;border: 0;}ol {list-style-type: decimal;}ol ol, ul ol {list-style-type: lower-latin;}ol ol ol, ul ol ol, ul ul ol, ol ul ol {list-style-type: lower-roman;}table {border-spacing: 0;border-collapse: collapse;margin-top: 0;margin-bottom: 16px;}table th {font-weight: bold;}table th, table td {padding: 6px 13px;border: 1px solid #ddd;}table tr {border-top: 1px solid #ccc;}table tr:nth-child(even) {background-color: #f8f8f8;}input[type="checkbox"] {cursor: default;margin-right: 0.5em;font-size: 13px;}.task-list-item {list-style-type: none;}.task-list-item+.task-list-item {margin-top: 3px;}.task-list-item input {float: left;margin: 0.3em 1em 0.25em -1.6em;vertical-align: middle;}#tag-field {margin: 8px 2px 10px;}#tag-field .tag {display: inline-block;background: #cadff3;border-radius: 4px;padding: 1px 8px;color: black;font-size: 12px;margin-right: 10px;line-height: 1.4;}</style>
      <!-- ace-static.css -->
      <style>.ace_static_highlight {white-space: pre-wrap;}.ace_static_highlight .ace_gutter {width: 2em;text-align: right;padding: 0 3px 0 0;margin-right: 3px;}.ace_static_highlight.ace_show_gutter > .ace_line {padding-left: 2.6em;}.ace_static_highlight .ace_line {position: relative;}.ace_static_highlight .ace_gutter-cell {-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;top: 0;bottom: 0;left: 0;position: absolute;}.ace_static_highlight .ace_gutter-cell:before {content: counter(ace_line, decimal);counter-increment: ace_line;}.ace_static_highlight {counter-reset: ace_line;}</style>
      <style>.ace-chrome .ace_gutter {background: #ebebeb;color: #333;overflow : hidden;}.ace-chrome .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-chrome {background-color: #FFFFFF;color: black;}.ace-chrome .ace_cursor {color: black;}.ace-chrome .ace_invisible {color: rgb(191, 191, 191);}.ace-chrome .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-chrome .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-chrome .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-chrome .ace_invalid {background-color: rgb(153, 0, 0);color: white;}.ace-chrome .ace_fold {}.ace-chrome .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-chrome .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-chrome .ace_support.ace_type,.ace-chrome .ace_support.ace_class.ace-chrome .ace_support.ace_other {color: rgb(109, 121, 222);}.ace-chrome .ace_variable.ace_parameter {font-style:italic;color:#FD971F;}.ace-chrome .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-chrome .ace_comment {color: #236e24;}.ace-chrome .ace_comment.ace_doc {color: #236e24;}.ace-chrome .ace_comment.ace_doc.ace_tag {color: #236e24;}.ace-chrome .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-chrome .ace_variable {color: rgb(49, 132, 149);}.ace-chrome .ace_xml-pe {color: rgb(104, 104, 91);}.ace-chrome .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-chrome .ace_heading {color: rgb(12, 7, 255);}.ace-chrome .ace_list {color:rgb(185, 6, 144);}.ace-chrome .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-chrome .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-chrome .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-chrome .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-chrome .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-chrome .ace_gutter-active-line {background-color : #dcdcdc;}.ace-chrome .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-chrome .ace_storage,.ace-chrome .ace_keyword,.ace-chrome .ace_meta.ace_tag {color: rgb(147, 15, 128);}.ace-chrome .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-chrome .ace_string {color: #1A1AA6;}.ace-chrome .ace_entity.ace_other.ace_attribute-name {color: #994409;}.ace-chrome .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}</style>
      <!-- export.css -->
      <style>
        body{margin:0 auto;max-width:800px;line-height:1.4}
        #nav{margin:5px 0 10px;font-size:15px}
        #titlearea{border-bottom:1px solid #ccc;font-size:17px;padding:10px 0;}
        #contentarea{font-size:15px;margin:16px 0}
        .cell{outline:0;min-height:20px;margin:5px 0;padding:5px 0;}
        .code-cell{font-family:Menlo,Consolas,'Ubuntu Mono',Monaco,'source-code-pro',monospace;font-size:12px;}
        .latex-cell{white-space:pre-wrap;}
      </style>
      <!-- User CSS -->
      <style> .text-cell {font-size: 15px;}.code-cell {font-size: 12px;}.markdown-cell {font-size: 15px;}.latex-cell {font-size: 15px;}</style>
    </head>
    <body>
      <div id="nav"><div>Next: <a href='2.1 Introduction to Object-Oriented Programming.html'>2.1 Introduction to Object-Oriented Programming</a>, Previous: <a href='1.6 Choosing Test Cases.html'>1.6 Choosing Test Cases</a>, Up: <a href='index.html'>Index</a></div></div>
      <div id="titlearea">
        <h2>1.7 Introduction to Property-based Testing</h2>
      </div>
      <div id="contentarea"><div class="cell text-cell"><p>Hypothesis is a Python testing library that we’ll use occasionally in this course for exercises and assignments. It’s already available on the Teaching Lab machines, and you should have installed it on your own computer when you went through the steps of the Software Guide on Quercus.</p>
<p>When writing tests, we often try to identify key properties on the inputs to the function being tested. We then pick representative inputs that meet these properties, and use these inputs to write tests. We can extend this idea to trying to identify key properties of the function itself: central relationships between their inputs and outputs that must hold for all possible inputs. This type of testing is called <strong>property-based testing</strong>, and the most famous implementation of this type of testing in Python is the <code>hypothesis</code>library.</p>
</div><div class="cell text-cell"><h2>An example</h2>
<p>Let’s see a concrete example of what these property tests might look like. Consider the following function:</p>
</div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">def</span> <span class="ace_identifier">insert_after</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lst</span>: <span class="ace_identifier">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">int</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">n1</span>: <span class="ace_support ace_function">int</span>, <span class="ace_identifier">n2</span>: <span class="ace_support ace_function">int</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">-&gt;</span> <span class="ace_constant ace_language">None</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_string">"""After each occurrence of &lt;n1&gt; in &lt;lst&gt;, insert &lt;n2&gt;.</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_string">    &gt;&gt;&gt; lst = [5, 1, 2, 1, 6]</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_string">    &gt;&gt;&gt; insert_after(lst, 1, 99)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_string">    &gt;&gt;&gt; lst</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_string">    [5, 1, 99, 2, 1, 99, 6]</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_string">    """</span>
</div></div></div></div><div class="cell text-cell"><p>We’ll test two properties of this function, which should hold for any valid input:</p>
<pre><code>1.  `insert_after` always returns `None`.
2.  `insert_after` increases the length of `lst` by the number of times that `n1` occurs in that list.
</code></pre>
<p>Our first test is the following:</p>
</div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">from</span> <span class="ace_identifier">typing</span> <span class="ace_keyword">import</span> <span class="ace_identifier">List</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">from</span> <span class="ace_identifier">hypothesis</span> <span class="ace_keyword">import</span> <span class="ace_identifier">given</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">from</span> <span class="ace_identifier">hypothesis</span>.<span class="ace_identifier">strategies</span> <span class="ace_keyword">import</span> <span class="ace_identifier">integers</span>, <span class="ace_identifier">lists</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">from</span> <span class="ace_identifier">insert</span> <span class="ace_keyword">import</span> <span class="ace_identifier">insert_after</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>@<span class="ace_identifier">given</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lists</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">integers</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">))</span>, <span class="ace_identifier">integers</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>, <span class="ace_identifier">integers</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">))</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">def</span> <span class="ace_identifier">test_returns_none</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lst</span>: <span class="ace_identifier">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">int</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">n1</span>: <span class="ace_support ace_function">int</span>, <span class="ace_identifier">n2</span>: <span class="ace_support ace_function">int</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">-&gt;</span> <span class="ace_constant ace_language">None</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_string">"""Test that insert_after always returns None.</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_string">    """</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">assert</span> <span class="ace_identifier">insert_after</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lst</span>, <span class="ace_identifier">n1</span>, <span class="ace_identifier">n2</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword">is</span> <span class="ace_constant ace_language">None</span>
</div></div></div></div><div class="cell text-cell"><p>The test case (<code>test_returns_none</code>) is preceded by the line <code>@given(lists(integers()), integers(), integers())</code>; what this line does is tell <code>hypothesis</code> to generate “random” inputs of the given types: a list of integers, and then two other integers. These values are then passed to the test function, which then simply calls <code>insert_after</code> on them, and checks that the output is <code>None</code>.</p>
<p>The most interesting part is that the “<code>given</code>” line doesn’t just generate one set of random inputs; instead, it generates dozens of them (or even hundreds, depending on how hypothesis is configured), and runs this test function on each one! We call the input specifiers like <code>integers()</code> or <code>lists()</code> a <em>strategy</em>; we’ll see more examples of strategies throughout the term.</p>
<h3>A more complex property</h3>
<p>Even though the previous test looked pretty straight-forward, don’t be fooled! Since a property test is just a Python function, we can write pretty complex tests using all of our Python knowledge.</p>
<p>For example, to test the second property we mentioned, we’ll need to store both the original length of <code>lst</code>, and the number of times that <code>n1</code> appeared in it:</p>
</div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>@<span class="ace_identifier">given</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lists</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">integers</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">))</span>, <span class="ace_identifier">integers</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>, <span class="ace_identifier">integers</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">))</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">def</span> <span class="ace_identifier">test_new_item_count</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lst</span>: <span class="ace_identifier">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">int</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">n1</span>: <span class="ace_support ace_function">int</span>, <span class="ace_identifier">n2</span>: <span class="ace_support ace_function">int</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">-&gt;</span> <span class="ace_constant ace_language">None</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_string">"""Test that the correct number of items is added.</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_string">    """</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">num_n1_occurrences</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">lst</span>.<span class="ace_identifier">count</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">n1</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">original_length</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_support ace_function">len</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lst</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">insert_after</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lst</span>, <span class="ace_identifier">n1</span>, <span class="ace_identifier">n2</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">final_length</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_support ace_function">len</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lst</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">assert</span> <span class="ace_identifier">final_length</span> <span class="ace_keyword ace_operator">-</span> <span class="ace_identifier">original_length</span> <span class="ace_keyword ace_operator">==</span> <span class="ace_identifier">num_n1_occurrences</span>
</div></div></div></div><div class="cell text-cell"><h2>Further reading</h2>
<p>Hypothesis is a powerful property-based testing library, and we’re only scratching the surface of it here. If you’d like more information, please consult the <a href="https://hypothesis.readthedocs.io/en/latest/index.html">official Hypothesis documentation</a>.</p>
</div></div>
      <script>document.body.onkeyup = function(e) {
if (e.keyCode === 39) window.location.href = '2.1 Introduction to Object-Oriented Programming.html';
if (e.keyCode === 37) window.location.href = '1.6 Choosing Test Cases.html';
}</script>
    </body>
    </html>
  