
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- common.css -->
      <style>* {-webkit-tap-highlight-color: rgba(0,0,0,0);}html {-webkit-text-size-adjust: none;}body {font-family: -apple-system, Helvetica, Arial, sans-serif;margin: 0;padding: 20px;color: #333;word-wrap: break-word;}h1, h2, h3, h4, h5, h6 {line-height: 1.1;}img {max-width: 100% !important;height: auto;}blockquote {margin: 0;padding: 0 15px;color: #777;border-left: 4px solid #ddd;}hr {background-color: #ddd;border: 0;height: 1px;margin: 15px 0;}code {font-family: Menlo, Consolas, 'Ubuntu Mono', Monaco, 'source-code-pro', monospace;line-height: 1.4;margin: 0;padding: 0.2em 0;font-size: 90%;background-color: rgba(0,0,0,0.04);border-radius: 3px;}pre > code {margin: 0;padding: 0;font-size: 100%;word-break: normal;background: transparent;border: 0;}ol {list-style-type: decimal;}ol ol, ul ol {list-style-type: lower-latin;}ol ol ol, ul ol ol, ul ul ol, ol ul ol {list-style-type: lower-roman;}table {border-spacing: 0;border-collapse: collapse;margin-top: 0;margin-bottom: 16px;}table th {font-weight: bold;}table th, table td {padding: 6px 13px;border: 1px solid #ddd;}table tr {border-top: 1px solid #ccc;}table tr:nth-child(even) {background-color: #f8f8f8;}input[type="checkbox"] {cursor: default;margin-right: 0.5em;font-size: 13px;}.task-list-item {list-style-type: none;}.task-list-item+.task-list-item {margin-top: 3px;}.task-list-item input {float: left;margin: 0.3em 1em 0.25em -1.6em;vertical-align: middle;}#tag-field {margin: 8px 2px 10px;}#tag-field .tag {display: inline-block;background: #cadff3;border-radius: 4px;padding: 1px 8px;color: black;font-size: 12px;margin-right: 10px;line-height: 1.4;}</style>
      <!-- ace-static.css -->
      <style>.ace_static_highlight {white-space: pre-wrap;}.ace_static_highlight .ace_gutter {width: 2em;text-align: right;padding: 0 3px 0 0;margin-right: 3px;}.ace_static_highlight.ace_show_gutter > .ace_line {padding-left: 2.6em;}.ace_static_highlight .ace_line {position: relative;}.ace_static_highlight .ace_gutter-cell {-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;top: 0;bottom: 0;left: 0;position: absolute;}.ace_static_highlight .ace_gutter-cell:before {content: counter(ace_line, decimal);counter-increment: ace_line;}.ace_static_highlight {counter-reset: ace_line;}</style>
      <style>.ace-chrome .ace_gutter {background: #ebebeb;color: #333;overflow : hidden;}.ace-chrome .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-chrome {background-color: #FFFFFF;color: black;}.ace-chrome .ace_cursor {color: black;}.ace-chrome .ace_invisible {color: rgb(191, 191, 191);}.ace-chrome .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-chrome .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-chrome .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-chrome .ace_invalid {background-color: rgb(153, 0, 0);color: white;}.ace-chrome .ace_fold {}.ace-chrome .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-chrome .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-chrome .ace_support.ace_type,.ace-chrome .ace_support.ace_class.ace-chrome .ace_support.ace_other {color: rgb(109, 121, 222);}.ace-chrome .ace_variable.ace_parameter {font-style:italic;color:#FD971F;}.ace-chrome .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-chrome .ace_comment {color: #236e24;}.ace-chrome .ace_comment.ace_doc {color: #236e24;}.ace-chrome .ace_comment.ace_doc.ace_tag {color: #236e24;}.ace-chrome .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-chrome .ace_variable {color: rgb(49, 132, 149);}.ace-chrome .ace_xml-pe {color: rgb(104, 104, 91);}.ace-chrome .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-chrome .ace_heading {color: rgb(12, 7, 255);}.ace-chrome .ace_list {color:rgb(185, 6, 144);}.ace-chrome .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-chrome .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-chrome .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-chrome .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-chrome .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-chrome .ace_gutter-active-line {background-color : #dcdcdc;}.ace-chrome .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-chrome .ace_storage,.ace-chrome .ace_keyword,.ace-chrome .ace_meta.ace_tag {color: rgb(147, 15, 128);}.ace-chrome .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-chrome .ace_string {color: #1A1AA6;}.ace-chrome .ace_entity.ace_other.ace_attribute-name {color: #994409;}.ace-chrome .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}</style>
      <!-- export.css -->
      <style>
        body{margin:0 auto;max-width:800px;line-height:1.4}
        #nav{margin:5px 0 10px;font-size:15px}
        #titlearea{border-bottom:1px solid #ccc;font-size:17px;padding:10px 0;}
        #contentarea{font-size:15px;margin:16px 0}
        .cell{outline:0;min-height:20px;margin:5px 0;padding:5px 0;}
        .code-cell{font-family:Menlo,Consolas,'Ubuntu Mono',Monaco,'source-code-pro',monospace;font-size:12px;}
        .latex-cell{white-space:pre-wrap;}
      </style>
      <!-- User CSS -->
      <style> .text-cell {font-size: 15px;}.code-cell {font-size: 12px;}.markdown-cell {font-size: 15px;}.latex-cell {font-size: 15px;}</style>
    </head>
    <body>
      <div id="nav"><div>Previous: <a href='5.1 Motivation  Adding up numbers.html'>5.1 Motivation: Adding up numbers</a>, Up: <a href='index.html'>Index</a></div></div>
      <div id="titlearea">
        <h2>5.2 Nested Lists: A Recursive Data Structure</h2>
      </div>
      <div id="contentarea"><div class="cell text-cell"><p>In the previous section, we ended by articulating a fundamental limitation of our <code>sum_list</code> functions: they cannot handle heterogeneous nested lists like</p>
</div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">[[</span><span class="ace_constant ace_numeric">1</span>, <span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">]]</span>, <span class="ace_paren ace_lparen">[[[</span><span class="ace_constant ace_numeric">3</span><span class="ace_paren ace_rparen">]]]</span>, <span class="ace_constant ace_numeric">4</span>, <span class="ace_paren ace_lparen">[[</span><span class="ace_constant ace_numeric">5</span>, <span class="ace_constant ace_numeric">6</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_paren ace_lparen">[[[</span><span class="ace_constant ace_numeric">7</span><span class="ace_paren ace_rparen">]]]]]</span>
</div></div></div></div><div class="cell text-cell"><p>In this section, we’ll overcome this limitation by using a new strategy: breaking down an object or problem into <em>smaller instances with the same structure as the original</em>.</p>
<p>To make this more concrete, let’s first identify how the object we are working with, a nested list, can be broken down into smaller instances with the same structure. We will define a new structure that generalizes the idea of “list of lists of lists of … of lists of ints”. We define a <strong>nested list</strong> as one of two types of values:</p>
<ul>
<li>A single integer.</li>
<li>A list of other nested lists (<code>[lst_1, lst_2, ..., lst_n]</code>). Each <code>sublist</code> is called a <em>sub-nested-list</em> of the outer list.</li>
</ul>
<p>This is a <strong>recursive definition</strong>: it defines nested lists in terms of other nested lists.&nbsp;It may seem a bit odd that we include “single integers” as nested lists; after all, <code>isinstance(3, list)</code> is False in Python! As we’ll see a few times in this section, it is very convenient to include this part of our recursive definition, and makes both the rest of the definition and the subsequent code we’ll write much more elegant.</p>
<p>The <em>depth</em> of a nested list is the maximum number of times a list is nested inside other lists, and we will define the depth of a single integer to be 0. So <code>[1, 2, 3]</code> has depth 1, and</p>
</div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">1</span>, <span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">2</span>, <span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">3</span>, <span class="ace_constant ace_numeric">4</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_constant ace_numeric">5</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">6</span>, <span class="ace_constant ace_numeric">7</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_constant ace_numeric">8</span><span class="ace_paren ace_rparen">]</span>
</div></div></div></div><div class="cell text-cell"><p>has depth 3.</p>
</div><div class="cell text-cell"><h2>Summing up a nested list</h2>
<p>We can use this definition to guide the design of a function that computes the sum on a nested list of numbers:</p>
</div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">def</span> <span class="ace_identifier">sum_nested</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">obj</span>: <span class="ace_identifier">Union</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">int</span>, <span class="ace_identifier">List</span><span class="ace_paren ace_rparen">])</span> <span class="ace_keyword ace_operator">-&gt;</span> <span class="ace_support ace_function">int</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_string">"""Return the sum of the numbers in a nested list &lt;obj&gt;.</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_string">    """</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">if</span> <span class="ace_support ace_function">isinstance</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">obj</span>, <span class="ace_support ace_function">int</span><span class="ace_paren ace_rparen">)</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_comment"># obj is an integer</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_keyword">return</span> <span class="ace_identifier">obj</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">else</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_comment"># obj is a list of nested lists: [lst_1, ..., lst_n]</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">s</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_keyword">for</span> <span class="ace_identifier">sublist</span> <span class="ace_keyword">in</span> <span class="ace_identifier">obj</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_comment"># each sublist is a nested list</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">s</span> <span class="ace_keyword ace_operator">+=</span> <span class="ace_identifier">sum_nested</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">sublist</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_keyword">return</span> <span class="ace_identifier">s</span>
</div></div></div></div><div class="cell text-cell"><p>This is our first example of a <em>recursive function</em>: a function that calls itself in its body. Just as we defined a recursive data structure—nested lists—we have now defined a recursive function that operates on nested lists. Notice how the structure of the data informs the structure of the code: just as the definition of nested lists separates integers and lists of nested lists into two cases, so too does the function <code>sum_nested</code>. And as the recursive part of the definition involves a list of nested lists, our code involves a loop over a list, binds <code>sublist</code> to each inner nested list one at a time, and calls <code>sum_nested</code> on it to compute the sum.</p>
<p>We call the case where <code>obj</code> is an integer the <strong>base case</strong> of the code: implementing the function’s behaviour on this type of input should be very straightforward, and not involve any recursion. The other case, in which <code>obj</code> is a list, is called the <strong>recursive case</strong>: solving the problem in this case requires decomposing the input into smaller nested lists, and calling <code>sum_nested</code> on these individually to solve the problem. The example above is the simplest type of recursive function, one that has just one base case and one recursive case. Later on, we’ll look at more complex recursive data structures and functions.</p>
</div><div class="cell text-cell"><h2>Partial tracing: reasoning about recursive calls</h2>
<p>We say that the call to <code>sum_nested</code> inside the <code>for</code> loop is a <strong>recursive function call</strong>, since it appears in the body of <code>sum_nested</code> itself. Such function calls are handled in the same way as all other function calls in Python, but the nature of recursion means that a single initial function call often results in many different calls to the exact same function.</p>
<p>When given a function call on a very complex nested list argument, beginners will often attempt to trace through the code carefully, including tracing what happens on each recursive call. Their thoughts go something like “Well, we enter the loop and make a recursive call. That recursive call will make this other recursive call, which will make this other recursive call, and so on.” This type of literal tracing is what a computer does, but it’s also <em>extremely time-consuming and error-prone</em> for humans to do.</p>
<p>Instead, whenever we are given a recursive function and a particular input we want to trace the function call on, we use the technique of <strong>partial tracing</strong>, which we’ll describe now. There are two cases.</p>
<h3>Case 1: The input corresponds to a base case</h3>
<p>For example, suppose we want to trace the call <code>sum_nested(5)</code>. The input <code>5</code> is an integer, the simplest kind of nested list. In our recursive function, this corresponds to the <code>if</code> condition being true, and so to trace our code we can simply trace the <code>if</code> branch directly, <em>completely ignoring the <code>else</code> branch</em>!</p>
</div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">def</span> <span class="ace_identifier">sum_nested</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">obj</span>: <span class="ace_identifier">Union</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">int</span>, <span class="ace_identifier">List</span><span class="ace_paren ace_rparen">])</span> <span class="ace_keyword ace_operator">-&gt;</span> <span class="ace_support ace_function">int</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_string">"""Return the sum of the numbers in a nested list &lt;obj&gt;.</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_string">    """</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">if</span> <span class="ace_support ace_function">isinstance</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">obj</span>, <span class="ace_support ace_function">int</span><span class="ace_paren ace_rparen">)</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_comment"># obj is an integer</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_keyword">return</span> <span class="ace_identifier">obj</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">else</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ...
</div></div></div></div><div class="cell text-cell"><p>Tracing this is pretty easy: the line of code <code>return obj</code> simply returns the input, which was <code>5</code>. This is the correct result: <code>sum_nested(5)</code> <em>should</em> return <code>5</code>, since the sum of a single integer is just the integer itself.</p>
<h3>Case 2: The input corresponds to a recursive case</h3>
<p>For example, suppose we want to trace the call <code>sum_nested([1, [2, [3, 4], 5], [6, 7], 8])</code> and verify that the output is the correct value of 36. This input corresponds to the <code>else</code> branch of <code>sum_nested</code>, which we show below:</p>
</div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">else</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_comment"># obj is a list of nested lists: [lst_1, ..., lst_n]</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">s</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_keyword">for</span> <span class="ace_identifier">sublist</span> <span class="ace_keyword">in</span> <span class="ace_identifier">obj</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_comment"># each sublist is a nested list</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">s</span> <span class="ace_keyword ace_operator">+=</span> <span class="ace_identifier">sum_nested</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">sublist</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_keyword">return</span> <span class="ace_identifier">s</span>
</div></div></div></div><div class="cell text-cell"><p>This code is an instance of the <em>accumulator</em> pattern, in which we loop over <code>obj</code>, and for each value update the accumulator variable <code>s</code>. Naive tracing is challenging, though, because at each loop iteration we’ll make a recursive call to <code>sum_nested</code>, which may result in tracing many subsequent recursive calls until we finally can update our accumulator.</p>
<p>So the key idea of partial tracing is the following: we’ll trace through the above code, but every time there’s a recursive call, instead of tracing into it, we <em>assume it is correct</em>, and simply use the correct return value and continue tracing the rest of our code.</p>
<p>To facilitate this, we use a <em>table of values</em>, that we build up as follows.</p>
<ol>
<li>First, we take our input <code>obj</code>, <code>[1, [2, [3, 4], 5], [6, 7], 8]</code>, and identify each sub-nested-list. Note that there are only four of them (we don’t count sub-nested-lists of sub-nested-lists).&nbsp;<table style="box-sizing: border-box; margin: 1em auto; padding: 0px; outline: none; caret-color: rgb(68, 68, 68); color: rgb(68, 68, 68); font-family: &quot;Open Sans&quot;, sans-serif; font-size: 19.200000762939453px;"><thead style="box-sizing: border-box; margin: 0px; padding: 0px;"><tr class="header" style="box-sizing: border-box; margin: 0px; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: lightgrey;"><th style="box-sizing: border-box; margin: 0px; padding: 8px; background-color: rgb(238, 238, 255); text-align: center; vertical-align: top; border-bottom-color: black;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">sublist</code></th></tr></thead><tbody style="box-sizing: border-box; margin: 0px; padding: 0px;"><tr class="odd" style="box-sizing: border-box; margin: 0px; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: lightgrey;"><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">1</code></td></tr><tr class="even" style="box-sizing: border-box; margin: 0px; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: lightgrey;"><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">[2, [3, 4], 5]</code></td></tr><tr class="odd" style="box-sizing: border-box; margin: 0px; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: lightgrey;"><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">[6, 7]</code></td></tr><tr class="even" style="box-sizing: border-box; margin: 0px; padding: 0px; border-bottom-style: none;"><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">8</code></td></tr></tbody></table></li>
<li>Next, beside each one we write down what <code>sum_nested</code> <em>should</em> return on each input. Remember that we aren’t doing any tracing here; instead, we’re filling this in based on the <em>documentation</em> for <code>sum_nested</code>.&nbsp;<table style="box-sizing: border-box; margin: 1em auto; padding: 0px; outline: none; caret-color: rgb(68, 68, 68); color: rgb(68, 68, 68); font-family: &quot;Open Sans&quot;, sans-serif; font-size: 19.200000762939453px;"><thead style="box-sizing: border-box; margin: 0px; padding: 0px;"><tr class="header" style="box-sizing: border-box; margin: 0px; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: lightgrey;"><th style="box-sizing: border-box; margin: 0px; padding: 8px; background-color: rgb(238, 238, 255); text-align: center; vertical-align: top; border-bottom-color: black;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">sublist</code></th><th style="box-sizing: border-box; margin: 0px; padding: 8px; background-color: rgb(238, 238, 255); text-align: center; vertical-align: top; border-bottom-color: black;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">sum_nested(sublist)</code></th></tr></thead><tbody style="box-sizing: border-box; margin: 0px; padding: 0px;"><tr class="odd" style="box-sizing: border-box; margin: 0px; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: lightgrey;"><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">1</code></td><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">1</code></td></tr><tr class="even" style="box-sizing: border-box; margin: 0px; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: lightgrey;"><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">[2, [3, 4], 5]</code></td><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">14</code></td></tr><tr class="odd" style="box-sizing: border-box; margin: 0px; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: lightgrey;"><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">[6, 7]</code></td><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">13</code></td></tr><tr class="even" style="box-sizing: border-box; margin: 0px; padding: 0px; border-bottom-style: none;"><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">8</code></td><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">8</code></td></tr></tbody></table></li>
<li>Finally, we trace through the code from the original <code>else</code> block, updating the value of the accumulator <code>s</code> using the above table. We show these updates in tabular form below.&nbsp;<table style="box-sizing: border-box; margin: 1em auto; padding: 0px; outline: none; caret-color: rgb(68, 68, 68); color: rgb(68, 68, 68); font-family: &quot;Open Sans&quot;, sans-serif; font-size: 19.200000762939453px;"><thead style="box-sizing: border-box; margin: 0px; padding: 0px;"><tr class="header" style="box-sizing: border-box; margin: 0px; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: lightgrey;"><th style="box-sizing: border-box; margin: 0px; padding: 8px; background-color: rgb(238, 238, 255); text-align: center; vertical-align: top; border-bottom-color: black;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">sublist</code></th><th style="box-sizing: border-box; margin: 0px; padding: 8px; background-color: rgb(238, 238, 255); text-align: center; vertical-align: top; border-bottom-color: black;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">sum_nested(sublist)</code></th><th style="box-sizing: border-box; margin: 0px; padding: 8px; background-color: rgb(238, 238, 255); text-align: center; vertical-align: top; border-bottom-color: black;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">s</code></th></tr></thead><tbody style="box-sizing: border-box; margin: 0px; padding: 0px;"><tr class="odd" style="box-sizing: border-box; margin: 0px; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: lightgrey;"><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">N/A</code></td><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">N/A</code></td><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">0</code>&nbsp;<code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">(initial value)</code></td></tr><tr class="even" style="box-sizing: border-box; margin: 0px; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: lightgrey;"><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">1</code></td><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">1</code></td><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">1</code>&nbsp;<code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">(s += 1)</code></td></tr><tr class="odd" style="box-sizing: border-box; margin: 0px; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: lightgrey;"><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">[2, [3, 4], 5]</code></td><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">14</code></td><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">15</code>&nbsp;<code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">(s += 14)</code></td></tr><tr class="even" style="box-sizing: border-box; margin: 0px; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: lightgrey;"><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">[6, 7]</code></td><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">13</code></td><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">28</code>&nbsp;<code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">(s += 13)</code></td></tr><tr class="odd" style="box-sizing: border-box; margin: 0px; padding: 0px; border-bottom-style: none;"><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">8</code></td><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">8</code></td><td style="box-sizing: border-box; margin: 0px; padding: 10px 8px; text-align: center; vertical-align: top; background-color: ivory;"><code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">36</code>&nbsp;<code style="box-sizing: border-box; padding: 0px 2px 1px; font-family: Inconsolata, monospace; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(244, 244, 244); white-space: pre;">(s += 8)</code></td></tr></tbody></table></li>
</ol>
</div><div class="cell text-cell"><p>From our table, we see that after the loop completes, the final value of <code>s</code> is <code>36</code>, and this is the value returned by our original call to <code>sum_nested</code>. It also happens to be the correct value!</p>
</div><div class="cell text-cell"><h2>Why does partial tracing work?</h2>
<p>When students first see the partial tracing technique, they are often suspicious: “What do you mean you can <em>assume</em> that the recursive calls are correct? What if they aren’t?!” In other words: yes, this technique is simpler, but why should we trust it?</p>
<p>It turns out that this assumption is valid, as long as both of the following properties hold:</p>
<ol>
<li>You are sure that your base case is correct. (You can usually fully trace the code directly to determine this.)</li>
<li>Every time you make a recursive call, it is on a <em>smaller</em> input than the original input.</li>
</ol>
<p>Here’s how to apply these ideas to show that <code>sum_nested</code> is correct:</p>
<ol>
<li>Since I’m confident in the base case for <code>sum_nested</code>, I now know that <code>sum_nested</code> is correct for all nested lists of depth 0.</li>
<li>If I have a nested list of depth 1, every recursive call I make is going to be on a nested list of depth 0. I’m going to assume that they’re correct (because of my previous statement). So then using partial tracing, I’m confident that <code>sum_nested</code> is correct for all nested lists of depth 1.</li>
<li>If I have a nested list of depth 2, every recursive call I make is going to be on a nested list of depth 0 or 1. I’m going to assume that they’re correct (because of my previous two statements). So then using partial tracing, I’m confident that <code>sum_nested</code> is correct for all nested lists of depth 2.</li>
<li>And so on.</li>
</ol>
<p>This idea is formalized in the <em>Principle of Mathematical Induction</em>, a formal proof technique that you’ll learn about in CSC165/240. It’s beyond the scope of this course, but rest assured that it tells us that partial tracing is a valid technique for reasoning about the correctness of recursive functions.</p>
<h3>What this means for testing and debugging</h3>
<p>The flip side of this is, if you have a recursive function and it’s <em>incorrect</em> (say, failing a test case that you wrote), there can only be one of the following problems:</p>
<ol>
<li>A base case is incorrect.</li>
<li>One or more of the recursive calls is <em>not</em> being made on a smaller input.</li>
<li>The recursive case is incorrect, <em>even if you assume</em> that every recursive call is correct! In other words, the problem isn’t in the recursive call itself, it’s in the code surrounding that recursive call.</li>
</ol>
<h2>Design Recipe for recursive functions</h2>
<ol>
<li>Identify the recursive structure of the problem, which can usually be reduced to finding the recursive structure of the <em>input</em>. Figure out if it’s a nested list, or some other data type that can be expressed recursively.</li>
</ol>
<p>Once you do this, you can often write down a <em>code template</em> to guide the structure of your code. For example, the code template for nested lists is:</p>
</div><div class="cell code-cell"><div class="ace-chrome"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">def</span> <span class="ace_identifier">f</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">obj</span>: <span class="ace_identifier">Union</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">int</span>, <span class="ace_identifier">List</span><span class="ace_paren ace_rparen">])</span> <span class="ace_keyword ace_operator">-&gt;</span> ...:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">if</span> <span class="ace_support ace_function">isinstance</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">obj</span>, <span class="ace_support ace_function">int</span><span class="ace_paren ace_rparen">)</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    ...
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword">else</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_keyword">for</span> <span class="ace_identifier">sublist</span> <span class="ace_keyword">in</span> <span class="ace_identifier">obj</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    ... <span class="ace_identifier">f</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">sublist</span><span class="ace_paren ace_rparen">)</span> ...
</div></div></div></div><div class="cell text-cell"><ol>
<li>Identify and implement code for the <strong>base case(s)</strong>. Note that you can usually tell exactly what the base cases are based on the structure of the input to the function. For nested lists, the common base case is when the input is an integer—and if you follow the above template, you won’t forget it.</li>
<li>Write down a concrete example of the function call on an input of some complexity (e.g., a nested list of depth 3). Then write down the relevant recursive function calls (determined by the structure of the input), and what they output <strong>based on the docstring of the function</strong>. In other words, write down the first two columns of the table we described above in the section on partial tracing.</li>
<li>Take your results from step 3, and figure out how to combine them to produce the correct output for the original call. This is usually the hardest step, but once you figure this out, you can implement the recursive step in your code!</li>
</ol>
</div><div class="cell text-cell"></div><div class="cell text-cell"></div></div>
      <script>document.body.onkeyup = function(e) {
if (e.keyCode === 37) window.location.href = '5.1 Motivation  Adding up numbers.html';
}</script>
    </body>
    </html>
  